FROM node:20-alpine

WORKDIR /workspace

# Copy workspace root + all package.json files so npm can resolve workspaces
COPY package.json ./
COPY frontend/package*.json ./frontend/
COPY shared/core/package.json ./shared/core/
COPY ocean/ui/package.json ./ocean/ui/
COPY shipwright/ui/package.json ./shipwright/ui/
COPY harbor/ui/package.json ./harbor/ui/
COPY ledger/ui/package.json ./ledger/ui/
COPY captain/ui/package.json ./captain/ui/
COPY skipper/ui/package.json ./skipper/ui/
COPY anchor/ui/package.json ./anchor/ui/
COPY keel/ui/package.json ./keel/ui/
COPY quartermaster/ui/package.json ./quartermaster/ui/
COPY tidewatch/ui/package.json ./tidewatch/ui/
COPY island/ui/package.json ./island/ui/

RUN npm install --workspace=frontend

WORKDIR /workspace/frontend

COPY <<'EOF' /entrypoint.sh
#!/bin/sh
set -e
exec npm run dev -- --host 0.0.0.0
EOF
RUN chmod +x /entrypoint.sh

EXPOSE 5173

CMD ["/entrypoint.sh"]
